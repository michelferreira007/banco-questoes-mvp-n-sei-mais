<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuestUEM - Banco de Questões UEM</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .filters {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .filters h3 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        select {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        select:focus {
            outline: none;
            border-color: #4facfe;
        }
        
        .question-container {
            padding: 30px;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .question-number {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }
        
        .badges {
            display: flex;
            gap: 10px;
        }
        
        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .badge-year {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .badge-subject {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .badge-exam {
            background: #e8f5e8;
            color: #388e3c;
        }
        
        .question-text {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 25px;
            color: #333;
        }
        
        .topic {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 20px;
        }
        
        .options {
            margin-bottom: 25px;
        }
        
        .option {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .option:hover {
            background: #f8f9fa;
            border-color: #4facfe;
        }
        
        .option.correct {
            background: #d4edda;
            border-color: #28a745;
        }
        
        .option.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
        }
        
        .option input {
            margin-right: 15px;
            transform: scale(1.2);
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .result {
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .result.correct {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .result.incorrect {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .result-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }
        
        .no-questions {
            text-align: center;
            padding: 50px;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .filter-row {
                grid-template-columns: 1fr;
            }
            
            .question-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>QuestUEM</h1>
            <p>Banco de Questões da Universidade Estadual de Maringá</p>
        </div>
        
        <div class="filters">
            <h3>Filtros</h3>
            <div class="filter-row">
                <select id="yearFilter">
                    <option value="">Todos os anos</option>
                </select>
                <select id="subjectFilter">
                    <option value="">Todas as matérias</option>
                </select>
                <select id="examTypeFilter">
                    <option value="">Todos os tipos</option>
                </select>
            </div>
        </div>
        
        <div id="questionContainer" class="question-container">
            <div class="loading">Carregando questões...</div>
        </div>
    </div>

    <script>
        let questions = [];
        let currentQuestionIndex = 0;
        let selectedAnswer = '';
        let showResult = false;
        let result = null;

        // Carregar filtros
        async function loadFilters() {
            try {
                const response = await fetch('/api/filters');
                const filters = await response.json();
                
                const yearSelect = document.getElementById('yearFilter');
                const subjectSelect = document.getElementById('subjectFilter');
                const examTypeSelect = document.getElementById('examTypeFilter');
                
                filters.years.forEach(year => {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    yearSelect.appendChild(option);
                });
                
                filters.subjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject;
                    option.textContent = subject;
                    subjectSelect.appendChild(option);
                });
                
                filters.exam_types.forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    examTypeSelect.appendChild(option);
                });
                
                // Adicionar event listeners
                yearSelect.addEventListener('change', loadQuestions);
                subjectSelect.addEventListener('change', loadQuestions);
                examTypeSelect.addEventListener('change', loadQuestions);
                
            } catch (error) {
                console.error('Erro ao carregar filtros:', error);
            }
        }

        // Carregar questões
        async function loadQuestions() {
            try {
                const params = new URLSearchParams();
                const year = document.getElementById('yearFilter').value;
                const subject = document.getElementById('subjectFilter').value;
                const examType = document.getElementById('examTypeFilter').value;
                
                if (year) params.append('year', year);
                if (subject) params.append('subject', subject);
                if (examType) params.append('exam_type', examType);
                
                const response = await fetch(`/api/questions?${params}`);
                questions = await response.json();
                
                currentQuestionIndex = 0;
                selectedAnswer = '';
                showResult = false;
                result = null;
                
                renderQuestion();
            } catch (error) {
                console.error('Erro ao carregar questões:', error);
                document.getElementById('questionContainer').innerHTML = 
                    '<div class="no-questions">Erro ao carregar questões</div>';
            }
        }

        // Renderizar questão
        function renderQuestion() {
            const container = document.getElementById('questionContainer');
            
            if (questions.length === 0) {
                container.innerHTML = '<div class="no-questions">Nenhuma questão encontrada</div>';
                return;
            }
            
            const question = questions[currentQuestionIndex];
            
            container.innerHTML = `
                <div class="question-header">
                    <div class="question-number">Questão ${currentQuestionIndex + 1} de ${questions.length}</div>
                    <div class="badges">
                        <span class="badge badge-year">${question.year}</span>
                        <span class="badge badge-subject">${question.subject}</span>
                        <span class="badge badge-exam">${question.exam_type}</span>
                    </div>
                </div>
                
                <div class="question-text">${question.question_text}</div>
                ${question.topic ? `<div class="topic">Tópico: ${question.topic}</div>` : ''}
                
                <div class="options">
                    ${['a', 'b', 'c', 'd', 'e'].map(option => `
                        <div class="option" onclick="selectAnswer('${option.toUpperCase()}')">
                            <input type="radio" name="answer" value="${option.toUpperCase()}" 
                                   ${selectedAnswer === option.toUpperCase() ? 'checked' : ''}
                                   ${showResult ? 'disabled' : ''}>
                            <span><strong>${option.toUpperCase()}) </strong>${question['option_' + option]}</span>
                        </div>
                    `).join('')}
                </div>
                
                ${showResult && result ? `
                    <div class="result ${result.correct ? 'correct' : 'incorrect'}">
                        <div class="result-header">
                            <span>${result.correct ? '✓' : '✗'}</span>
                            <span>${result.correct ? 'Resposta Correta!' : 'Resposta Incorreta'}</span>
                        </div>
                        ${result.explanation ? `<div>${result.explanation}</div>` : ''}
                    </div>
                ` : ''}
                
                <div class="buttons">
                    ${!showResult ? `
                        <button class="btn-primary" onclick="checkAnswer()" ${!selectedAnswer ? 'disabled' : ''}>
                            Verificar Resposta
                        </button>
                    ` : `
                        <button class="btn-secondary" onclick="resetQuestion()">
                            Tentar Novamente
                        </button>
                        <button class="btn-primary" onclick="nextQuestion()">
                            Próxima Questão
                        </button>
                    `}
                </div>
            `;
            
            updateOptionStyles();
        }

        // Selecionar resposta
        function selectAnswer(answer) {
            if (showResult) return;
            selectedAnswer = answer;
            renderQuestion();
        }

        // Verificar resposta
        async function checkAnswer() {
            if (!selectedAnswer) return;
            
            try {
                const response = await fetch('/api/check-answer', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question_id: questions[currentQuestionIndex].id,
                        answer: selectedAnswer
                    })
                });
                
                result = await response.json();
                showResult = true;
                renderQuestion();
            } catch (error) {
                console.error('Erro ao verificar resposta:', error);
            }
        }

        // Próxima questão
        function nextQuestion() {
            currentQuestionIndex = (currentQuestionIndex + 1) % questions.length;
            selectedAnswer = '';
            showResult = false;
            result = null;
            renderQuestion();
        }

        // Resetar questão
        function resetQuestion() {
            selectedAnswer = '';
            showResult = false;
            result = null;
            renderQuestion();
        }

        // Atualizar estilos das opções
        function updateOptionStyles() {
            if (!showResult || !result) return;
            
            const options = document.querySelectorAll('.option');
            options.forEach(option => {
                const input = option.querySelector('input');
                const value = input.value;
                
                if (value === result.correct_answer) {
                    option.classList.add('correct');
                } else if (value === selectedAnswer && !result.correct) {
                    option.classList.add('incorrect');
                }
            });
        }

        // Inicializar aplicação
        document.addEventListener('DOMContentLoaded', () => {
            loadFilters();
            loadQuestions();
        });
    </script>
</body>
</html>

